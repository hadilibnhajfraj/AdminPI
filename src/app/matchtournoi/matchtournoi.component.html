<div class="container">
  <h2>Liste des matchs par tournoi</h2>

  <!-- Groupement par tour -->
  <div *ngFor="let tour of groupesParTour | keyvalue">
    <h4 class="mt-4">Tour {{ tour.key }}</h4>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Nom du Match</th>
          <th>Match (Score)</th>
          <th>Date</th>
          <th>Heure</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let match of tour.value">
          <td>{{ match.nom }}</td>
          <td>
            {{ match.equipes1[0]?.nom || '√âquipe 1' }} /
            {{ match.scoreEquipe1 ?? 0 }} - {{ match.scoreEquipe2 ?? 0 }} /
            {{ match.equipes1[1]?.nom || '√âquipe 2' }}
          </td>
          <td>{{ match.dateMatch || '-' }}</td>
          <td>{{ match.heureMatch || '-' }}</td>
          <td>
            <button (click)="ouvrirPopup(match)" class="btn btn-warning btn-sm mb-1">Mettre √† jour le score</button>
            <button (click)="ouvrirPopupTerrain(match)" class="btn btn-info btn-sm">Affecter terrain</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <p *ngIf="matchs.length === 0 && selectedTournoiId">
    Aucun match trouv√© pour ce tournoi.
  </p>

  <!-- Bouton g√©n√©ration du tour suivant -->
  <div class="text-center mt-4" *ngIf="tourSuivantVisible">
    <button class="btn btn-primary" (click)="genererTourSuivant()">G√©n√©rer le tour suivant</button>
  </div>

  <!-- Pop-up mise √† jour des scores -->
  <div *ngIf="popupVisible" class="modal">
    <div class="modal-content">
      <h3>Mise √† jour des scores</h3>
      <p>{{ matchSelectionne?.nom }} - Tour {{ matchSelectionne?.tour }}</p>

      <div class="form-group">
        <label>Score √âquipe 1 ({{ matchSelectionne?.equipes1[0]?.nom || '√âquipe 1' }}):</label>
        <input type="number" [(ngModel)]="scoreEquipe1" class="form-control" />
      </div>

      <div class="form-group">
        <label>Score √âquipe 2 ({{ matchSelectionne?.equipes1[1]?.nom || '√âquipe 2' }}):</label>
        <input type="number" [(ngModel)]="scoreEquipe2" class="form-control" />
      </div>

      <div class="modal-buttons mt-3">
        <button (click)="validerMiseAJour()" class="btn btn-success">Valider</button>
        <button (click)="fermerPopup()" class="btn btn-secondary">Annuler</button>
      </div>
    </div>
  </div>

  <!-- Popup Affectation Terrain -->
  <div *ngIf="popupTerrainVisible" class="modal">
    <div class="modal-content">
      <h3>Affecter un terrain</h3>
      <p>Match : {{ matchSelectionne?.nom }}</p>

      <!-- √âtape 1 : Choix du terrain -->
      <div>
        <h5>Choisir un terrain :</h5>
        <div *ngIf="terrains.length === 0">Chargement des terrains...</div>
        <div *ngFor="let terrain of terrains" class="mb-2">
          <button class="btn btn-outline-primary w-100 text-start"
                  (click)="selectionnerTerrain(terrain)">
            {{ terrain.nom }} - {{ terrain.adresse }}
          </button>
        </div>
      </div>

      <!-- √âtape 2 : Choix de la date -->
      <div *ngIf="terrainSelectionne" class="mt-3">
        <h5>Date du match :</h5>
        <input type="date" class="form-control"
               [(ngModel)]="dateSelectionnee"
               (change)="chargerDisponibilites()" />
      </div>

      <!-- √âtape 3 : Cr√©neaux disponibles -->
      <!-- √âtape 3 : Cr√©neaux horaires de 8h √† 22h -->
<div *ngIf="terrainSelectionne && disponibilites[terrainSelectionne.id]" class="mt-3">
  <h5>Emploi du temps :</h5>
  <table class="table table-bordered text-center">
    <thead>
      <tr>
        <th>Heure</th>
        <th>Disponibilit√©</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let heure of plagesHoraires">
        <td>{{ heure }} - {{ getHeureFin(heure) }}</td>
        <td>
          <ng-container *ngIf="disponibilites[terrainSelectionne.id].includes(heure); else bloque">
            <button class="btn btn-success btn-sm"
                    (click)="reserverTerrain(terrainSelectionne.id, dateSelectionnee, heure)">
              R√©server
            </button>
          </ng-container>
          <ng-template #bloque>
            <span class="text-muted">R√©serv√©</span>
          </ng-template>
        </td>
      </tr>
    </tbody>
  </table>
</div>


      <button class="btn btn-secondary mt-3" (click)="fermerPopupTerrain()">Fermer</button>
    </div>
  </div>

  <!-- Popup Vainqueur -->
<div *ngIf="gagnant" class="modal">
  <div class="modal-content text-center">
    <h3>üèÜ Tournoi termin√© !</h3>
    <p>L'√©quipe gagnante est :</p>
    <h4 class="text-success">{{ gagnant }}</h4>
    <button class="btn btn-primary mt-3" (click)="gagnant = null">Fermer</button>
  </div>
</div>

</div>

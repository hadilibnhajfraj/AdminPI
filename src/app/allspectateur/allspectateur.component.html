<!-- Liste des publications -->
<div class="row mt-4">
  <div *ngFor="let publication of publications" class="col-12 mb-4">
    <div class="card shadow-sm">
      <div class="card-body">

        <!-- En-t√™te -->
        <div class="d-flex align-items-center mb-3">
          <div>
            <strong>Utilisateur</strong>
            <div class="text-muted small">
              Publi√© le {{ publication.datePublication | date : "short" }}
            </div>
          </div>
        </div>

        <!-- Contenu -->
        <p>{{ publication.contenu }}</p>

        <!-- Image -->
        <div *ngIf="isImage(publication.urlMedia)" class="text-center mb-3">
          <img [src]="'http://localhost:8082/' + publication.urlMedia"
               alt="Media"
               class="img-fluid rounded"
               style="max-height: 400px; object-fit: cover;" />
        </div>

        <!-- Vid√©o -->
        <div *ngIf="isVideo(publication.urlMedia)">
          <video [src]="'http://localhost:8082/' + publication.urlMedia"
                 controls
                 class="w-100 rounded mb-3"></video>
        </div>

        <!-- R√©actions -->
        <div class="d-flex justify-content-around text-muted border-top pt-2 position-relative">
          <div class="text-center position-relative">
            <div (click)="toggleReactions(publication.id)">
              <i class="bi bi-hand-thumbs-up me-1"></i>
              {{ selectedReactions[publication.id] || 'J‚Äôaime' }}
            </div>
            <div *ngIf="reactionVisibleId === publication.id"
                 class="reaction-menu d-flex justify-content-around p-1 bg-white rounded shadow position-absolute"
                 style="top: -50px; left: 0; right: 0; z-index: 10;">
              <span class="emoji" (click)="selectReaction(publication.id, '‚ù§Ô∏è')">‚ù§Ô∏è</span>
              <span class="emoji" (click)="selectReaction(publication.id, 'üò¢')">üò¢</span>
              <span class="emoji" (click)="selectReaction(publication.id, 'üòÇ')">üòÇ</span>
              <span class="emoji" (click)="selectReaction(publication.id, 'üò°')">üò°</span>
            </div>
          </div>
          <div><i class="bi bi-chat-dots me-1"></i>Commenter</div>
          <div><i class="bi bi-share me-1"></i>Partager</div>
        </div>

        <!-- Ajouter un commentaire -->
        <div class="mt-3">
          <textarea [(ngModel)]="comments[publication.id]"
                    placeholder="Ajouter un commentaire"
                    class="form-control"
                    rows="2"></textarea>
          <button class="btn btn-success btn-sm mt-2"
                  (click)="addComment(publication.id)">
            Commenter
          </button>
        </div>

        <!-- Liste des commentaires -->
        <div *ngIf="publication.commentaires?.length" class="mt-3">
          <div *ngFor="let commentaire of publication.commentaires" class="border rounded p-2 mb-2">

            <!-- Si √©dition en cours -->
            <div *ngIf="editingCommentId === commentaire.id">
              <textarea [(ngModel)]="editingCommentText"
                        class="form-control mb-2"
                        rows="2"></textarea>
              <button class="btn btn-primary btn-sm me-2"
                      (click)="updateComment(publication.id, commentaire.id)">
                Modifier
              </button>
              <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Annuler</button>
            </div>

            <!-- Sinon afficher commentaire -->
            <div *ngIf="editingCommentId !== commentaire.id">
              <textarea [value]="commentaire.texte"
                        readonly
                        class="form-control mb-2"
                        rows="2"></textarea>

              <small class="text-muted"> ¬∑ {{ commentaire.createdAt | date:'short' }}</small>

              <!-- Actions (si utilisateur connect√© est l‚Äôauteur du commentaire) -->
              <div *ngIf="commentaire.user?.id === userId" class="mt-2">
                <button class="btn btn-sm btn-outline-primary me-2"
                        (click)="editComment(publication.id, commentaire)">
                  Modifier
                </button>
                <button class="btn btn-sm btn-outline-danger"
                        (click)="deleteComment(publication.id, commentaire.id)">
                  Supprimer
                </button>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Aucun r√©sultat -->
<div *ngIf="publications.length === 0" class="text-center mt-4">
  <p class="text-muted">Aucune publication √† afficher.</p>
</div>
